<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>3D Viewer</title>
  <!-- Voyager web component -->
  <script type="module"
    src="https://cdn.jsdelivr.net/npm/@smithsonian/dpo-voyager/dist/voyager.js">
  </script>
  <style>
    body { margin:0; overflow:hidden; }
    voyager-explorer { width:100vw; height:100vh; display:block; }
    .toolbar {
      position: absolute;
      top: 1rem; right: 1rem;
      display: flex; flex-direction: column;
      gap: 0.5rem;
    }
    .toolbar button { padding:0.5rem 1rem; }
  </style>
</head>
<body>
  <voyager-explorer
    id="viewer"
    document="scene.json"
    aria-label="3D Model Viewer">
  </voyager-explorer>

  <div class="toolbar">
    <button onclick="viewer.toggleMeasurement()">Measure</button>
    <button onclick="viewer.toggleAnnotations()">POIs</button>
    <button onclick="setLightMode('svx')">General Light</button>
    <button onclick="setLightMode('hdri')">HDRI</button>
    <button onclick="viewer.enableAR()">View in AR</button>
  </div>

  <script>
    const viewer = document.getElementById('viewer');

    // Switch between SVX lights vs HDRI environment
    function setLightMode(mode) {
      if (mode === 'hdri') {
        viewer.dispatchEvent(new CustomEvent('use-hdri'));
      } else {
        viewer.reload({ document: 'scene.json' });
      }
    }

    // When HDRI is requested, inject the environment map
    viewer.addEventListener('use-hdri', () => {
      viewer.addEventListener('model-load', () => {
        const scene = viewer.scene;
        new THREE.RGBELoader()
          .setDataType(THREE.UnsignedByteType)
          .load('./rainforest_tra_
